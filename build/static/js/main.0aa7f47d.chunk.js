(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{172:function(e,t,n){"use strict";n.r(t);var a=n(40),o=n.n(a),r=n(0),i=n.n(r),l=n(179),c=n(178),s=(n(99),n(34)),u=n(21),d=n(22),m=n(24),h=n(23),p=n(25),f=n(9),b=n(78),v=n(79),g=n.n(v)()(),E={domain:"graphql-tutorials.auth0.com",clientId:"P38qnFo1lFAQJrzkun--wEzqljVNGcWW",callbackUrl:"http://localhost:3000/callback"},O=n(177),j=n(180),k=n(176),y=n(175),_=function(e){var t=e.logoutHandler;return i.a.createElement(y.a,{id:"qsLogoutBtn",bsStyle:"primary",className:"btn-margin logoutBtn",onClick:t},"Log Out")},w=function(e){var t=e.logoutHandler;return i.a.createElement(O.a,{fluid:!0,className:"m-bottom-0"},i.a.createElement(O.a.Header,{className:"navHeader"},i.a.createElement(O.a.Brand,{className:"navBrand"},"GraphQL Tutorial App"),i.a.createElement(j.a,{pullRight:!0},i.a.createElement(k.a,null,i.a.createElement(_,{logoutHandler:t})))))},T=n(33),N=n(93),C=n(16),I=n(17),S=n.n(I),q=n(18);function A(){var e=Object(C.a)(["\n  mutation toggleTodo ($id: Int!, $isCompleted: Boolean!) {\n    update_todos(where: {id: {_eq: $id}}, _set: {is_completed: $isCompleted}) {\n      affected_rows\n    }\n  }\n"]);return A=function(){return e},e}function x(){var e=Object(C.a)(["\n    mutation removeTodo ($id: Int!) {\n      delete_todos(where: {id: {_eq: $id}}) {\n        affected_rows\n      }\n    }\n  "]);return x=function(){return e},e}var L=Object(q.e)(function(e){e.index;var t=e.todo,n=e.client,a=S()(x()),o=S()(A());return i.a.createElement("li",null,i.a.createElement("div",{className:"view"},i.a.createElement("div",{className:"round"},i.a.createElement("input",{checked:t.is_completed,type:"checkbox",id:t.id,onChange:function(){n.mutate({mutation:o,variables:{id:t.id,isCompleted:!t.is_completed},optimisticResponse:{},update:function(e){var n=e.readQuery({query:H}).todos.map(function(e){return e.id===t.id?Object(s.a)({},e,{is_completed:!e.is_completed}):e});e.writeQuery({query:H,data:{todos:n}})}})}}),i.a.createElement("label",{htmlFor:t.id}))),i.a.createElement("div",{className:"labelContent"+(t.is_completed?" completed":"")},i.a.createElement("div",null,t.title)),i.a.createElement("button",{className:"closeBtn",onClick:function(e){e.preventDefault(),e.stopPropagation(),n.mutate({mutation:a,variables:{id:t.id},optimisticResponse:{},update:function(e){var n=e.readQuery({query:H}).todos.filter(function(e){return e.id!==t.id});e.writeQuery({query:H,data:{todos:n}})}})}},"x"))}),P=function(e){var t=e.todos,n=e.currentFilter,a=e.filterResultsFn,o=e.clearCompletedFn,r=function(e){return function(){a(e)}},l=i.a.createElement("button",{onClick:o,className:"clearComp"},"Clear completed"),c=t.filter(function(e){return!0!==e.is_completed}),s=t.length;return"active"===n?s=c.length:"completed"===n&&(s=t.length-c.length),i.a.createElement("div",{className:"footerList"},i.a.createElement("span",null," ",s," item",1!==s?"s":""),i.a.createElement("ul",null,i.a.createElement("li",{onClick:r("all")},i.a.createElement("a",{className:"all"===n?"selected":""},"All")),i.a.createElement("li",{onClick:r("active")},i.a.createElement("a",{className:"active"===n?"selected":""},"Active")),i.a.createElement("li",{onClick:r("completed")},i.a.createElement("a",{className:"completed"===n?"selected":""},"Completed"))),l)};function $(){var e=Object(C.a)(["\n      mutation clearCompleted {\n        delete_todos(where: {is_completed: {_eq: true}, is_public: {_eq: false}}) {\n          affected_rows\n        }\n      }\n    "]);return $=function(){return e},e}function F(){var e=Object(C.a)(["\n  query getMyTodos {\n    todos(where: { is_public: { _eq: false} }, order_by: { created_at: desc }) {\n      id\n      title\n      created_at\n      is_completed\n    }\n  }\n"]);return F=function(){return e},e}var H=S()(F()),B=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={filter:"all",clearInProgress:!1},n.filterResults=n.filterResults.bind(Object(f.a)(Object(f.a)(n))),n.clearCompleted=n.clearCompleted.bind(Object(f.a)(Object(f.a)(n))),n.client=e.client,n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"filterResults",value:function(e){this.setState(Object(s.a)({},this.state,{filter:e}))}},{key:"clearCompleted",value:function(){var e=S()($());this.client.mutate({mutation:e,optimisticResponse:{},update:function(e,t){t.data;var n=e.readQuery({query:H}).todos.filter(function(e){return!e.is_completed});e.writeQuery({query:H,data:{todos:n}})}})}},{key:"render",value:function(){var e=this.props.todos,t=e;"active"===this.state.filter?t=e.filter(function(e){return!0!==e.is_completed}):"completed"===this.state.filter&&(t=e.filter(function(e){return!0===e.is_completed}));var n=[];return t.forEach(function(e,t){n.push(i.a.createElement(L,{key:t,index:t,todo:e}))}),i.a.createElement(r.Fragment,null,i.a.createElement("div",{className:"todoListWrapper"},i.a.createElement("ul",null,n)),i.a.createElement(P,{todos:t,currentFilter:this.state.filter,filterResultsFn:this.filterResults,clearCompletedFn:this.clearCompleted,clearInProgress:this.state.clearInProgress}))}}]),t}(r.Component),D=function(){return i.a.createElement(q.c,{query:H},function(e){var t=e.loading,n=e.error,a=e.data,o=e.client;return t?i.a.createElement("div",null,"Loading..."):n?(console.error(n),i.a.createElement("div",null,"Error!")):i.a.createElement(B,{client:o,todos:a.todos})})};function Q(){var e=Object(C.a)(["\nmutation ($todo: String!, $isPublic: Boolean!) {\n  insert_todos(objects: {title: $todo, is_public: $isPublic}) {\n    affected_rows\n    returning {\n      id\n      title\n      created_at\n      is_completed\n    }\n  }\n}\n"]);return Q=function(){return e},e}var W=S()(Q()),M=function(e){var t,n=e.isPublic,a=void 0!==n&&n,o=Object(r.useState)(""),l=Object(N.a)(o,2),c=l[0],s=l[1];return i.a.createElement(q.b,{mutation:W,update:function(e,t){var n=t.data;if(a)return null;var o=e.readQuery({query:H}),r=n.insert_todos.returning[0];e.writeQuery({query:H,data:{todos:[r].concat(Object(T.a)(o.todos))}})},onCompleted:function(){s(""),t.focus()}},function(e,n){return n.loading,n.data,i.a.createElement("form",{className:"formInput",onSubmit:function(t){t.preventDefault(),e({variables:{todo:c,isPublic:a}})}},i.a.createElement("input",{className:"input",placeholder:"What needs to be done?",value:c,onChange:function(e){return s(e.target.value)},ref:function(e){return t=e}}),i.a.createElement("i",{className:"inputMarker fa fa-angle-right"}))})},R=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"todoWrapper"},i.a.createElement("div",{className:"sectionHeader"},"Personal todos"),i.a.createElement(M,null),i.a.createElement(D,null))}}]),t}(r.Component),U=function(e){e.index;var t=e.todo;return i.a.createElement("li",null,i.a.createElement("div",{className:"userInfoPublic",title:t.user.name},"@",t.user.name),i.a.createElement("div",{className:"labelContent"+(t.is_completed?" completed":"")},i.a.createElement("div",null,t.title)))};function z(){var e=Object(C.a)(["\nsubscription notifyNewPublicTodos {\n  todos (where: { is_public: { _eq: true}}, limit: 1, order_by: {created_at: desc }) {\n    id\n    created_at\n  }\n}\n"]);return z=function(){return e},e}function V(){var e=Object(C.a)(["\n      query getOldPublicTodos ($oldestTodoId: Int!) {\n        todos (where: { is_public: { _eq: true}, id: {_lt: $oldestTodoId}}, limit: 7, order_by: { created_at: desc }) {\n          id\n          title\n          created_at\n          user {\n            name\n          }\n        }\n      }"]);return V=function(){return e},e}function G(){var e=Object(C.a)(["\n     query getNewPublicTodos ($latestVisibleId: Int!) {\n       todos(where: { is_public: { _eq: true}, id: {_gt: $latestVisibleId}}, order_by: { created_at: desc }) {\n         id\n         title\n         created_at\n         user {\n           name\n         }\n       }\n     }\n   "]);return G=function(){return e},e}var J=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={olderTodosAvailable:!!e.latestTodo,newTodosCount:0,todos:[],error:!1},n.loadNew=n.loadNew.bind(Object(f.a)(Object(f.a)(n))),n.loadOlder=n.loadOlder.bind(Object(f.a)(Object(f.a)(n))),n.client=e.client,n.oldestTodoId=e.latestTodo.id+1,n.newestTodoId=e.latestTodo.id,n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"loadNew",value:function(){var e=this,t=S()(G());this.client.query({query:t,variables:{latestVisibleId:this.state.todos[0].id}}).then(function(t){var n=t.data;e.newestTodoId=n.todos[0].id,e.setState({todos:[].concat(Object(T.a)(n.todos),Object(T.a)(e.state.todos)),newTodosCount:0})}).catch(function(t){console.error(t),e.setState({error:!0})})}},{key:"loadOlder",value:function(){var e=this,t=S()(V());this.client.query({query:t,variables:{oldestTodoId:this.oldestTodoId}}).then(function(t){var n=t.data;n.todos.length?(e.oldestTodoId=n.todos[n.todos.length-1].id,e.setState({todos:[].concat(Object(T.a)(e.state.todos),Object(T.a)(n.todos))})):e.setState({olderTodosAvailable:!1})}).catch(function(t){console.error(t),e.setState({error:!0})})}},{key:"componentDidUpdate",value:function(e){this.props.latestTodo.id>this.newestTodoId&&(this.newestTodoId=this.props.latestTodo.id,this.setState({newTodosCount:this.state.newTodosCount+1}))}},{key:"componentDidMount",value:function(){this.loadOlder()}},{key:"render",value:function(){var e=this.state.todos,t=i.a.createElement("ul",null,e.map(function(e,t){return i.a.createElement(U,{key:t,index:t,todo:e})})),n="";this.state.newTodosCount&&(n=i.a.createElement("div",{className:"loadMoreSection",onClick:this.loadNew},"New tasks have arrived! (",this.state.newTodosCount.toString(),")"));var a=i.a.createElement("div",{className:"loadMoreSection",onClick:this.loadOlder},this.state.olderTodosAvailable?"Load older tasks":"No more public tasks!");return i.a.createElement(r.Fragment,null,i.a.createElement("div",{className:"todoListWrapper"},n,t,a))}}]),t}(r.Component),K=Object(q.e)(J),X=S()(z()),Y=function(){return i.a.createElement(q.d,{subscription:X},function(e){var t=e.loading,n=e.error,a=e.data;return t?i.a.createElement("span",null,"Loading..."):n?i.a.createElement("span",null,"Error"):i.a.createElement(K,{latestTodo:a.todos.length?a.todos[0]:null})})},Z=function(){return i.a.createElement("div",{className:"todoWrapper"},i.a.createElement("div",{className:"sectionHeader"},"Public feed (realtime)"),i.a.createElement(M,{isPublic:!0}),i.a.createElement(Y,null))},ee=function(e){var t=e.user;return i.a.createElement("div",{className:"userInfo"},i.a.createElement("div",{className:"userImg"},i.a.createElement("i",{className:"far fa-user"})),i.a.createElement("div",{className:"userName"},t.name))};function te(){var e=Object(C.a)(["\n      subscription getOnlineUsers {\n        online_users(order_by: {user: {name: asc }}) {\n          id\n          user {\n            name\n          }\n        }\n      }"]);return te=function(){return e},e}function ne(){var e=Object(C.a)(["\n      mutation updateLastSeen ($now: timestamptz!) {\n        update_users(where: {}, _set: {last_seen: $now}) {\n          affected_rows\n        }\n      }"]);return ne=function(){return e},e}var ae=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).client=e.client,n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"updateLastSeen",value:function(){var e=S()(ne());this.client.mutate({mutation:e,variables:{now:(new Date).toISOString()}})}},{key:"componentDidMount",value:function(){var e=this;this.onlineIndicator=setInterval(function(){return e.updateLastSeen()},3e4)}},{key:"render",value:function(){return i.a.createElement("div",{className:"onlineUsersWrapper"},i.a.createElement(q.d,{subscription:S()(te())},function(e){var t=e.loading,n=e.error,a=e.data;if(t)return i.a.createElement("span",null,"Loading...");if(n)return console.error(n),i.a.createElement("span",null,"Error!");if(a){var o=a.online_users,l=[];return o.forEach(function(e,t){l.push(i.a.createElement(ee,{key:t,index:t,user:e.user}))}),i.a.createElement(r.Fragment,null,i.a.createElement("div",{className:"sliderHeader"},"Online users - ",o.length),l)}}))}}]),t}(r.Component),oe=Object(q.e)(ae),re=n(35),ie=n(92),le=n(89),ce=function(e){var t,n=e.auth,a=(t=n.idToken,new re.c({link:new le.a({uri:"wss://learn.hasura.io/graphql",options:{reconnect:!0,connectionParams:{headers:{Authorization:"Bearer ".concat(t)}}}}),cache:new ie.a}));return i.a.createElement(q.a,{client:a},i.a.createElement("div",null,i.a.createElement(w,{logoutHandler:n.logout}),i.a.createElement("div",{className:"container-fluid p-left-right-0"},i.a.createElement("div",{className:"col-xs-12 col-md-9 p-left-right-0"},i.a.createElement("div",{className:"col-xs-12 col-md-6 sliderMenu p-30"},i.a.createElement(R,null)),i.a.createElement("div",{className:"col-xs-12 col-md-6 sliderMenu p-30 bg-gray border-right"},i.a.createElement(Z,null))),i.a.createElement("div",{className:"col-xs-12 col-md-3 p-left-right-0"},i.a.createElement("div",{className:"col-xs-12 col-md-12 sliderMenu p-30 bg-gray"},i.a.createElement(oe,null))))))},se=n(90),ue=n.n(se),de=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:{position:"absolute",display:"flex",justifyContent:"center",height:"100vh",width:"100vw",top:0,bottom:0,left:0,right:0,backgroundColor:"white"}},i.a.createElement("img",{src:ue.a,alt:"loading"}))}}]),t}(r.Component),me=function(e){var t=e.loginHandler;return i.a.createElement("div",{className:"overlay"},i.a.createElement("div",{className:"overlay-content"},i.a.createElement("div",{className:"overlay-heading"},"Welcome to the GraphQL tutorial app"),i.a.createElement("div",{className:"overlay-message"},"Please login to continue"),i.a.createElement("div",{className:"overlay-action"},i.a.createElement(y.a,{id:"qsLoginBtn",bsStyle:"primary",className:"btn-margin loginBtn",onClick:t},"Log In"))))},he=function(e){function t(){var e;return Object(u.a)(this,t),(e=Object(m.a)(this,Object(h.a)(t).call(this))).auth0=new b.a.WebAuth({domain:E.domain,clientID:E.clientId,redirectUri:E.callbackUrl,audience:"https://".concat(E.domain,"/userinfo"),responseType:"token id_token",scope:"openid profile"}),e.handleAuthentication=function(){e.setState({isAuthenticated:"loading"}),e.auth0.parseHash(function(t,n){n&&n.accessToken&&n.idToken?e.setSession(n):t&&(e.logout(),console.error(t),alert("Error: ".concat(t.error," - ").concat(t.errorDescription)))})},e.login=e.login.bind(Object(f.a)(Object(f.a)(e))),e.logout=e.logout.bind(Object(f.a)(Object(f.a)(e))),e.handleAuthentication=e.handleAuthentication.bind(Object(f.a)(Object(f.a)(e))),e.isExpired=e.isExpired.bind(Object(f.a)(Object(f.a)(e))),e.getAccessToken=e.getAccessToken.bind(Object(f.a)(Object(f.a)(e))),e.getIdToken=e.getIdToken.bind(Object(f.a)(Object(f.a)(e))),e.renewSession=e.renewSession.bind(Object(f.a)(Object(f.a)(e))),e.state={isAuthenticated:!1,idToken:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"login",value:function(){this.auth0.authorize()}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"getIdToken",value:function(){return this.idToken}},{key:"setSession",value:function(e){localStorage.setItem("isLoggedIn","true");var t=1e3*e.expiresIn+(new Date).getTime();this.accessToken=e.accessToken,this.idToken=e.idToken,this.expiresAt=t,g.replace("/"),this.setState({isAuthenticated:!0,idToken:e.idToken})}},{key:"renewSession",value:function(){var e=this;this.setState({isAuthenticated:"loading"}),this.auth0.checkSession({},function(t,n){n&&n.accessToken&&n.idToken?e.setSession(n):t&&(e.logout(),console.log(t),alert("Could not get a new token (".concat(t.error,": ").concat(t.error_description,").")))})}},{key:"logout",value:function(){this.accessToken=null,this.idToken=null,this.expiresAt=0,localStorage.removeItem("isLoggedIn"),this.auth0.logout({return_to:window.location.origin}),g.replace("/"),this.setState({isAuthenticated:!1,idToken:null})}},{key:"isExpired",value:function(){var e=this.expiresAt;return(new Date).getTime()>e}},{key:"componentDidMount",value:function(){var e=this.props.location;e&&e.pathname.startsWith("/callback")&&/access_token|id_token|error/.test(e.hash)?this.handleAuthentication():"true"!==localStorage.getItem("isLoggedIn")||this.renewSession()}},{key:"render",value:function(){return"loading"===this.state.isAuthenticated?i.a.createElement(de,this.props):this.state.isAuthenticated?i.a.createElement(ce,Object.assign({},this.props,{auth:Object(s.a)({},this.state,{login:this.login,logout:this.logout})})):i.a.createElement(me,{loginHandler:this.login})}}]),t}(i.a.Component),pe=i.a.createElement(l.a,{history:g},i.a.createElement(c.a,{path:"/",render:function(e){return i.a.createElement(he,e)}}));o.a.render(pe,document.getElementById("root"))},90:function(e,t,n){e.exports=n.p+"static/media/loading.c5590569.svg"},94:function(e,t,n){e.exports=n(172)},99:function(e,t,n){}},[[94,1,2]]]);
//# sourceMappingURL=main.0aa7f47d.chunk.js.map